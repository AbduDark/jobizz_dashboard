<!DOCTYPE html>
<html lang="en">
 <head>
 <!-- Title Of The Page -->
   <title>Login || Metrix</title>
    <!-- Meta Information -->
    <meta charset="UTF-8" />
    <meta
    name="viewport"
    content="width=device-width, height=device-height, initial-scale=1.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
    name="description"
    content="Metrix is a sleek and modern app landing page template built with HTML, CSS, and JavaScript. It's designed to showcase your app's features and attract potential users." />
    <meta name="keywords" content="Metrix - App Landing Page Template" />
    <meta name="author" content="white orange software" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="noindex" />

    <!-- Favicons -->
    <link
    rel="apple-touch-icon"
    sizes="72x72"
    href="/assets/images/favicons/apple-touch-icon.png" />
    <link
    rel="icon"
     type="images/png"
     sizes="32x32"
    href="assets/images/favicons/favicon-32x32.png" />
    <link
    rel="icon"
    type="images/png"
    sizes="16x16"
    href="assets/images/favicons/favicon-16x16.png" />
    <link
  rel="mask-icon"
  href="/assets/images/favicons/safari-pinned-tab.svg"
    color="#ffffff" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="theme-color" content="#ffffff" />

    <!-- All Css -->

    <link type="text/css" rel="stylesheet" href="assets/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
      .error-box {
        margin-top: 15px;
        padding: 12px;
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
        border-radius: 5px;
        display: none;
        font-size: 14px;
        text-align: center;
      }

      .error-box.show {
        display: block;
        animation: fadeIn 0.3s ease-in-out;
      }

      .success-box {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
        margin-right: 8px;
        vertical-align: middle;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .btn-loading {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .form-group {
        position: relative;
        margin-bottom: 20px;
       
      }

      .password-toggle {
        position: absolute;
        right: 10px;
        top: 40%;
        transform: translateY(-50%);
        cursor: pointer;
      
      }

      .password-toggle:hover {
        color: #555;
      }
     
    </style>
  

    <link type="text/css" rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   
   </head>



  <body>
    <!-- Spinner Loader Start -->
    <div class="loader">
      <div id="loading-bar-spinner" class="spinner">
        <div class="spinner-icon"></div>
      </div>
    </div>

    <!-- Activity Page Section Starts Here-->
    <section class="activity-bg bg-norepeat-cover">

      <div class="container d-flex">
        <div class="activity-card">
          <div class="activity-logo-wrap">
            <a href="home.html" class="logo-img pb-0">
              <img src="./imag/logo.png" alt="logo-images" class="logo-image" />

            </a>
          </div>
          <div class="activity-card-heading">
            <h1 class="activity-card-header">Welcome Back</h1>
            <label class="activity-card-subtitle"
              >Lorem Ipsum is simply dummy text of the printing and type setting
              industry.</label
            >
          </div>
          <div class="activity-actions">
            <form id="loginForm" class="d-flex flex-column gap-4">
              <div class="form-group">
                <label for="userEmail"><i class="fas fa-envelope"></i></label>
                <input
                  type="email"
                  id="userEmail"
                  class="input-one"
                  placeholder="Email"
                  required />
              </div>
              <div class="form-group">
                <label for="userPassword"><i class="fas fa-lock"></i></label>
                <input
                  type="password"
                  id="userPassword"
                  class="input-one"
                  placeholder="Password"
                  required />
                <span class="password-toggle" id="togglePassword">
                <i class="fas fa-eye"></i>
                </span>
              </div>
              <div class="text-end">
                <a href="forget-password.html" class="activity-forget mb-0"
                  >Forget Password?</a
                >
              </div>
              <button
                type="submit"
                id="loginButton"
                class="btn-common btn-activity-confirm">
                Login
              </button>
              <div id="error-message-box" class="error-box"></div>
            </form>
          </div>
          <div class="activity-switch">
            <label class="activity-switch-title">Don't have an account?</label>
            <a href="signup.html" class="activity-go-link">Signup</a>
          </div>

      </div>
   
    <!-- Activity Page Section Ends Here-->
       <script>    document.addEventListener("DOMContentLoaded", () => {
      const token = sessionStorage.getItem("token");
      if (token) {
        const overlay = document.createElement("div");
    overlay.style.cssText = `
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background:  url('images/shinobu-kocho-5120x2880-19754.jpg') no-repeat center/cover;
      color: #00ffcc;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: 'Arial', sans-serif;
      text-align: center;
      z-index: 99999;
      animation: pulse 2s infinite ease-in-out;
      border: 5px solid #ff3366;
      box-sizing: border-box;
      animation: glow 1.2s infinite alternate;
    `;

    // Add CSS animations for pulse, glow, and text effects
    const style = document.createElement("style");
    style.textContent = `
      @keyframes pulse {
        0% { background-color: rgba(0, 0, 0, 0.7); }
        50% { background-color: rgba(0, 0, 0, 0.85); }
        100% { background-color: rgba(0, 0, 0, 0.7); }
      }
      @keyframes glow {
        0% { border-color: #ff3366; box-shadow: 0 0 8px #ff3366; }
        100% { border-color: #00ffcc; box-shadow: 0 0 20px #00ffcc; }
      }
      @keyframes textPulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.9; }
        100% { transform: scale(1); opacity: 1; }
      }
    `;
    document.head.appendChild(style);

    // Countdown starts at 5
    let countdown = 5;

    overlay.innerHTML = `
      <h1 style="font-size: 32px; margin-bottom: 20px; animation: textPulse 1s infinite;">
        ðŸ”’ You're already <span style="color: #ff3366;">Logged in</span>
      </h1>
      <p style="font-size: 20px; margin-bottom: 10px; animation: textPulse 1.2s infinite;">
        Please log out and try again
      </p>
      <p style="font-size: 18px;">
        Redirecting in: <span id="countdown" style="color: #ffcc00;">${countdown}</span>...
      </p>
      <p id="audioError" style="font-size: 16px; color: #ff3366; display: none;">
        Failed to play sound. Check your device or browser audio settings.
      </p>
    `;

    document.body.appendChild(overlay);

    // Initialize Web Audio API
    // let audioCtx;
    // try {
    //   audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    //   // Attempt to resume AudioContext automatically
    //   if (audioCtx.state === 'suspended') {
    //     audioCtx.resume().catch((e) => {
    //       console.error('Auto-resume failed:', e);
    //       document.getElementById('audioError').style.display = 'block';
    //     });
    //   }

    //   // Function to play short alert sound
    //   function playAlertSound(freq) {
    //     const oscillator = audioCtx.createOscillator();
    //     const gainNode = audioCtx.createGain();
    //     oscillator.type = 'triangle'; // Triangle wave for clear alert sound
    //     oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
    //     gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime); // Moderate volume
    //     oscillator.connect(gainNode);
    //     gainNode.connect(audioCtx.destination);
    //     oscillator.start();
    //     oscillator.stop(audioCtx.currentTime + 0.3); // Short 0.3s sound
    //   }

    //   // Countdown and redirect
    //   const frequencies = [440, 523.25, 659.25, 784, 880]; // A4, C5, E5, G5, A5
      const interval = setInterval(() => {
        countdown--;
        document.getElementById("countdown").textContent = countdown;

        // Play alert sound for each countdown number
        if (countdown > 0) {
          setTimeout(() => {
            // playAlertSound(frequencies[countdown - 1] || 440); // Use different frequency for each number
          }, 50); // Slight delay to ensure audio context is ready
        }

        if (countdown <= 0) {
          clearInterval(interval);
          window.location.href = "profile.html"; // Immediate redirect
        }
      }, 1000);
    // } catch (e) {
      // Show error message if audio fails
    //   document.getElementById('audioError').style.display = 'block';
    //   console.error('AudioContext initialization failed:', e);
    }
  }

      
    );</script>
    <!-- Jquery Javascript File -->
    <script src="assets/js/jquery.min.js"></script>
    <!-- Bootstrap Bundle Javascript File -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <!-- Owl Carousel Javascript File -->
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- Smooth Scroll Javascript File -->
    <script src="assets/js/smoothscroll.min.js"></script>
    <!-- Default Javascript File -->
    <script src="assets/js/svg.js"></script>
    <script src="assets/js/custom.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/login.js"></script>
   
 


<script>
  // Enhanced login.js to support both API and locally created admins
document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('loginForm');
    const emailInput = document.getElementById('userEmail');
    const passwordInput = document.getElementById('userPassword');
    const loginButton = document.getElementById('loginButton');
    const errorBox = document.getElementById('error-message-box');
    const togglePassword = document.getElementById('togglePassword');

    // API endpoints
    const LOGIN_API_URL = 'https://jobizaa.com/api/auth/login';
    const USER_PROFILE_URL = 'https://jobizaa.com/api/user/profile';

    // Password toggle functionality
    if (togglePassword && passwordInput) {
        togglePassword.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            const icon = togglePassword.querySelector('i');
            icon.classList.toggle('fa-eye');
            icon.classList.toggle('fa-eye-slash');
        });
    }

    // Function to show error message
    function showError(message) {
        if (errorBox) {
            errorBox.textContent = message;
            errorBox.classList.add('show');
            setTimeout(() => {
                errorBox.classList.remove('show');
            }, 5000);
        }
    }

    // Function to show success message
    function showSuccess(message) {
        if (errorBox) {
            errorBox.textContent = message;
            errorBox.classList.add('show', 'success-box');
            setTimeout(() => {
                errorBox.classList.remove('show', 'success-box');
            }, 3000);
        }
    }

    // Function to set loading state
    function setLoadingState(isLoading) {
        if (loginButton) {
            if (isLoading) {
                loginButton.innerHTML = '<span class="spinner"></span>Logging in...';
                loginButton.disabled = true;
                loginButton.classList.add('btn-loading');
            } else {
                loginButton.innerHTML = 'Login';
                loginButton.disabled = false;
                loginButton.classList.remove('btn-loading');
            }
        }
    }

    // Function to check locally created admins
    function checkLocalAdmin(email, password) {
        const localAdmins = JSON.parse(localStorage.getItem('superAdmins') || '[]');
        
        const admin = localAdmins.find(admin => 
            admin.email.toLowerCase() === email.toLowerCase()
        );

        if (admin) {
            // For locally created admins, we stored the plain password
            // In production, you should hash passwords!
            if (admin.password === password) {
                return {
                    success: true,
                    user: {
                        id: admin.id,
                        email: admin.email,
                        name: admin.name || admin.fullName,
                        phone: admin.phone,
                        role: admin.role || 'super-admin'
                    },
                    token: 'local_admin_' + admin.id // Generate a local token
                };
            } else {
                return {
                    success: false,
                    message: 'Invalid password'
                };
            }
        }

        return null; // Admin not found locally
    }

    // Function to login via API
    async function loginViaAPI(email, password) {
        try {
            const response = await fetch(LOGIN_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    email: email,
                    password: password
                })
            });

            const data = await response.json();

            if (response.ok && data.success) {
                return {
                    success: true,
                    user: data.user || data.data?.user,
                    token: data.token || data.access_token || data.data?.token
                };
            } else {
                return {
                    success: false,
                    message: data.message || 'Login failed'
                };
            }
        } catch (error) {
            console.error('API Login Error:', error);
            return {
                success: false,
                message: 'Network error. Please check your connection.'
            };
        }
    }

    // Function to handle successful login
    function handleSuccessfulLogin(loginResult) {
        // Store authentication data
        localStorage.setItem('access_token', loginResult.token);
        localStorage.setItem('token', loginResult.token);
        sessionStorage.setItem('token', loginResult.token);
        
        // Store user data
        localStorage.setItem('userData', JSON.stringify(loginResult.user));
        localStorage.setItem('userRole', loginResult.user.role || 'user');
        
        showSuccess('Login successful! Redirecting...');
        
        // Redirect based on user role
        setTimeout(() => {
            const userRole = loginResult.user.role || 'user';
            
            switch(userRole) {
                case 'super-admin':
                case 'admin':
                    window.location.href = 'index.html'; // Admin dashboard
                    break;
                case 'company':
                    window.location.href = 'company-dashboard.html'; // Company dashboard
                    break;
                default:
                    window.location.href = 'user-dashboard.html'; // User dashboard
            }
        }, 1500);
    }

    // Main login function
    async function handleLogin(email, password) {
        setLoadingState(true);

        try {
            // First, check for locally created admins
            const localLoginResult = checkLocalAdmin(email, password);
            
            if (localLoginResult) {
                if (localLoginResult.success) {
                    handleSuccessfulLogin(localLoginResult);
                    return;
                } else {
                    showError(localLoginResult.message);
                    return;
                }
            }

            // If not found locally, try API login
            const apiLoginResult = await loginViaAPI(email, password);
            
            if (apiLoginResult.success) {
                handleSuccessfulLogin(apiLoginResult);
            } else {
                showError(apiLoginResult.message);
            }

        } catch (error) {
            console.error('Login Error:', error);
            showError('An unexpected error occurred. Please try again.');
        } finally {
            setLoadingState(false);
        }
    }

    // Form submission handler
    if (loginForm) {
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = emailInput.value.trim();
            const password = passwordInput.value;

            // Basic validation
            if (!email || !password) {
                showError('Please enter both email and password');
                return;
            }

            if (!isValidEmail(email)) {
                showError('Please enter a valid email address');
                return;
            }

            await handleLogin(email, password);
        });
    }

    // Email validation helper
    function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    // Check if user is already logged in
    function checkExistingLogin() {
        const token = localStorage.getItem('access_token') || sessionStorage.getItem('token');
        const userData = localStorage.getItem('userData');
        
        if (token && userData) {
            try {
                const user = JSON.parse(userData);
                console.log('User already logged in:', user);
                
                // You can uncomment the next line if you want to auto-redirect logged-in users
                // window.location.href = user.role === 'admin' || user.role === 'super-admin' ? 'index.html' : 'profile.html';
            } catch (error) {
                console.error('Error parsing stored user data:', error);
                // Clear corrupted data
                localStorage.removeItem('userData');
                localStorage.removeItem('access_token');
                sessionStorage.removeItem('token');
            }
        }
    }

    // Initialize
    checkExistingLogin();
});

// Global logout function (can be called from anywhere)
function logout() {
    // Clear all stored authentication data
    localStorage.removeItem('access_token');
    localStorage.removeItem('token');
    localStorage.removeItem('userData');
    localStorage.removeItem('userRole');
    sessionStorage.removeItem('token');
    
    // Redirect to login page
    window.location.href = 'login.html';
}

// Export for use in other scripts
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { logout };
}
</script>


  
</body>
</html>

    
   
  




