<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Profile | Hyper - Responsive Bootstrap 5 Admin Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
    <meta content="Coderthemes" name="author" />

    <!-- Dependencies -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link href="assets/css/app-saas.min.css" rel="stylesheet" type="text/css" id="app-style" />
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        .wrapper.content-shift {
            /* margin-left: 180px; */
            margin-top: 90px;
        }
        .notification-dropdown {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            width: 300px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            right: 0;
        }
        .notification-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .notification-item:last-child {
            border-bottom: none;
        }
        .notification-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .notification-content {
            flex-grow: 1;
        }
        .view-all {
            display: block;
            text-align: center;
            padding: 10px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin: 10px auto;
            width: 90px;
        }
        .view-all:hover {
            background-color: #0056b3;
        }
        #map {
            height: 300px;
            width: 100%;
            margin-bottom: 20px;
            z-index: 1;
        }
        .company-info {
            margin-top: 20px;
        }
        .company-info p {
            margin-bottom: 10px;
        }
        .no-company {
            text-align: center;
            color: #6c757d;
            font-size: 1.2em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="top-bar">
        <div class="search-container">
            <input type="text" placeholder="Search..." class="search-input">
            <button class="search-button">
                <i class="fa-sharp fa-solid fa-magnifying-glass"></i>
            </button>
        </div>
        <div class="icon-section">
            <i class="fas fa-envelope"></i>
            <div class="notification-container">
                <i class="fas fa-bell" id="notificationBell"><span class="notification-badge">4</span></i>
                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="dropdown-header">
                        <h3>Notifications</h3>
                        <a href="#" class="mark-read">Mark all as read</a>
                    </div>
                    <div class="notification-list">
                        <div class="notification-section">
                            <h4>NEW</h4>
                            <div class="notification-item unread">
                                <img src="./images/menna.jpeg" alt="Notification Icon" class="notification-icon">
                                <div class="notification-content">
                                    Emma Watson replied to your comment: "Hello world ðŸ˜Š"
                                    <span class="notification-time">Just now</span>
                                </div>
                            </div>
                            <div class="notification-item unread">
                                <img src="./images/menna.jpeg" alt="Notification Icon" class="notification-icon">
                                <div class="notification-content">
                                    Emma Watson replied to your comment: "Hello world ðŸ˜Š"
                                    <span class="notification-time">Just now</span>
                                </div>
                            </div>
                        </div>
                        <div class="notification-section">
                            <h4>EARLIER</h4>
                            <div class="notification-item">
                                <img src="./images/istockphoto-1185418020-170667a.jpg" alt="Notification Icon" class="notification-icon">
                                <div class="notification-content">
                                    The forecast today shows a low of 20Â°C in California.
                                    <span class="notification-time">8h ago</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <a href="./nofigation.html" class="view-all">View all</a>
                </div>
            </div>
 <div class="user-profile" onclick="toggleDropdown()">
  <img id="companyLogo" src="assets/images/avata.jpeg" alt="Company Logo" />
  <span id="companyName">Company Name</span>

  <div class="dropdown-box">
    <div class="user-info">
      <h3 id="companyFullName">Company Name</h3>
      <a href="website"  id="companyWebsite">website.com</a>
                        </div>
                        <ul>
                <li><a href="profile.html" class="fas fa-user"> Profile</a></li>
                <li><a href="setting.html" class="fas fa-cog"> Setting</a></li>
                <li><a href="chat.html" class="fas fa-question-circle"> Support</a></li>
                <li><a href="#" class="fas fa-sign-out-alt" onclick="logout()">LogOut</a></li>
                        </ul>
                    </div>

                </div>
            </div>
        </nav>


    


<!-- =============== sidebar ================ -->

    <div class="sidebar">
      <div class="sidebar-header">
        <img src="assets/images/logo.png" alt="logo" />
        <div class="toggle-btn">â˜°</div>
      </div>

     <ul>
            <li data-id="dashboard" class="admin-only">
                <a href="index.html">
                    <span class="icon"><i class="fa-sharp fa-solid fa-house"></i></span>
                    <span class="text">Dashboard</span>
                </a>
            </li>
            <li data-id="users" class="admin-only">
                <a href="user.html">
                    <span class="icon"><i class="fa-solid fa-users"></i></span>
                    <span class="text">Users</span>
                </a>
            </li>
            <li data-id="jobs" class="user-only">
                <a href="job.html">
                    <span class="icon"><i class="fa-solid fa-briefcase"></i></span>
                    <span class="text">Jobs</span>
                </a>
            </li>
            <li data-id="view" class="user-only">
                <a href="view.html">
                    <span class="icon"><i class="fa-sharp fa-solid fa-eye"></i></span>
                    <span class="text">View jobs</span>
                </a>
            </li>
            <li data-id="companies" class="admin-only">
                <a href="company.html">
                    <span class="icon"><i class="fa-solid fa-buildings"></i></span>
                    <span class="text">Companies</span>
                </a>
            </li>
            <li class="user-only">
                <a href="chat.html">
                    <span class="icon"><i class="fas fa-comments"></i></span>
                    <span class="text">Chat</span>
                </a>
            </li>
            <li data-id="profile" class="user-only">
                <a href="profile.html">
                    <span class="icon"><i class="fa-solid fa-user"></i></span>
                    <span class="text">Profile</span>
                </a>
            </li>
            <li data-id="setting" class="admin-only">
                <a href="setting.html">
                    <span class="icon"><i class="fa-solid fa-gear"></i></span>
                    <span class="text">Settings</span>
                </a>
            </li>
            <li data-id="logout">
                <a href="#" onclick="auth.logout()">
                    <span class="icon"><i class="fa-solid fa-right-from-bracket"></i></span>
                    <span class="text">Logout</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="wrapper content-shift">
        <div class="content-page">
            <div class="content">
                <div class="container-fluid">
                    <!-- Page Title -->
                    <!-- <div class="row">
                        <div class="col-12">
                            <div class="page-title-box">
                                <div class="page-title-right">
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);"></a></li>
                                        <li class="breadcrumb-item"><a href="javascript: void(0);"></a></li>
                                        <li class="breadcrumb-item active"></li>
                                    </ol>
                                </div>
                                <h4 class="page-title"></h4>
                            </div>
                        </div>
                    </div> -->

                    <!-- Tabs -->
                    <div class="row">
                        <div class="col-xl-12 col-lg-12">
                            <div class="card">
                                <div class="card-body">
                                    <ul class="nav nav-pills bg-nav-pills nav-justified mb-3">
                                        <li class="nav-item">
                                            <a href="#about" data-bs-toggle="tab" aria-expanded="true" class="nav-link rounded-0 active">
                                                About My Company
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="#settings" data-bs-toggle="tab" aria-expanded="false" class="nav-link rounded-0" id="settingsTab">
                                                Add Company+ 
                                            </a>
                                        </li>
                                    </ul>
                                    <div class="tab-content">
                                        <!-- About Tab -->
                                        <div class="tab-pane show active" id="about">
                                            <h5 class="text-uppercase"><i class="mdi mdi-briefcase me-1"></i> Company Information</h5>
                                            <div id="companyInfo" class="company-info">
                                                <!-- Company info will be populated here -->
                                            </div>
                                        </div>
                                        <!-- Settings Tab -->
                                        <div class="tab-pane" id="settings">
                                            <form id="companyForm" enctype="multipart/form-data">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="companyname" class="form-label">Company Name</label>
                                                            <input type="text" class="form-control" id="name" placeholder="Enter company name" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="companylogo" class="form-label">Logo</label>
                                                            <input type="file" class="form-control" id="companylogo" accept="image/*" required>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="description" class="form-label">Description</label>
                                                            <input type="text" class="form-control" id="description" placeholder="Company description" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="location" class="form-label">Location (Click on map to select)</label>
                                                            <input type="text" class="form-control" id="location" placeholder="Select location on map" required>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="mb-3">
                                                            <label for="map" class="form-label">Company Location Map</label>
                                                            <div id="map"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="website" class="form-label">Website</label>
                                                            <input type="url" class="form-control" id="website" placeholder="https://example.com" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="mb-3">
                                                            <label for="size" class="form-label">Size</label>
                                                            <input type="text" class="form-control" id="size" placeholder="e.g. medium" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="mb-3">
                                                            <label for="hired_people" class="form-label">Hired People</label>
                                                            <input type="number" class="form-control" id="hired_people" placeholder="185000" required>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-end">
                                                    <button type="submit" class="btn btn-success" id="saveCompanyBtn">
                                                        <i class="bi bi-save"></i> Save
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/auth.js"></script>  
    <script src="js/login.js"></script>
    <script src="js/protect.js"></script>
    <script src="js/profile.js"></script>
    <script src="js/main.js"></script>
    <script src="js/navbar.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Protect page
            try {
                protectPage(['super-admin', 'admin']);
            } catch (error) {
                console.error('Protect page error:', error);
            }

            // Notification dropdown toggle
            try {
                const bell = document.getElementById('notificationBell');
                const dropdown = document.getElementById('notificationDropdown');
                if (bell && dropdown) {
                    bell.addEventListener('click', function (e) {
                        e.stopPropagation();
                        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
                        console.log('Notification dropdown toggled:', dropdown.style.display);
                    });
                    document.addEventListener('click', function (e) {
                        if (!dropdown.contains(e.target) && !bell.contains(e.target)) {
                            dropdown.style.display = 'none';
                            console.log('Notification dropdown closed');
                        }
                    });
                    const markReadLink = document.querySelector('.mark-read');
                    if (markReadLink) {
                        markReadLink.addEventListener('click', function (e) {
                            e.preventDefault();
                            document.querySelectorAll('.notification-item.unread').forEach(item => {
                                item.classList.remove('unread');
                            });
                            document.querySelector('.notification-badge').textContent = '0';
                            console.log('Notifications marked as read');
                        });
                    }
                } else {
                    console.error('Notification elements not found');
                }
            } catch (error) {
                console.error('Notification setup error:', error);
            }

            // Fetch company data
            async function fetchCompanyData() {
                const company_id = sessionStorage.getItem("company_id");
                if (!company_id) {
                    console.log('No company_id found in sessionStorage');
                    return null;
                }

                try {
                    const super_token = sessionStorage.getItem("super_token") || "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2pvYml6YWEuY29tL2FwaS9hZG1pbi9sb2dpbiIsImlhdCI6MTc0NzE3MzI1MSwibmJmIjoxNzQ3MTczMjUxLCJqdGkiOiJNNXNHU0lBNDZMa1AwM0wwIiwic3ViIjoiMSIsInBydiI6ImRmODgzZGI5N2JkMDVlZjhmZjg1MDgyZDY4NmM0NWU4MzJlNTkzYTkiLCJyb2xlcyI6WyJzdXBlci1hZG1pbiJdLCJwZXJtaXNzaW9ucyI6WyJtYW5hZ2UtYWxsLWNvbXBhbmllcyIsIm1hbmFnZS1hbGwtam9icyIsIm1hbmFnZS1yb2xlcyIsIm1hbmFnZS1jb21wYW55LWFkbWlucyIsIm1hbmFnZS1hcHBsaWNhdGlvbnMiLCJ2aWV3LWFwcGxpY2FudC1wcm9maWxlcyIsInNlbmQtbWVzc2FnZXMiXSwiY29tcGFueV9pZCI6bnVsbH0.X2ezIVql0YUgkruYV058QG8NpyHzAZSdHv60zAA_9R0";
                    const res = await fetch(`https://jobizaa.com/api/admin/companies/${company_id}`, {
                        method: "GET",
                        headers: {
                            Authorization: super_token,
                            Accept: "application/json"
                        }
                    });

                    const data = await res.json();
                    console.log('Company API response:', data);
                    return data?.data;
                } catch (error) {
                    console.error('Failed to fetch company data:', error);
                    return null;
                }
            }

            // Update About tab
            async function updateAboutTab() {
                try {
                    const data = await fetchCompanyData();
                    const companyInfoDiv = document.getElementById('companyInfo');
                    if (!companyInfoDiv) {
                        console.error('Company info div not found');
                        return;
                    }

                    if (!data || !data.company) {
                        companyInfoDiv.innerHTML = '<p class="no-company">You haven\'t created a company.</p>';
                        return;
                    }

                    const company = data.company;
                    const activeJobsCount = data.active_jobs ?? 0;

                    companyInfoDiv.innerHTML = `
                        <div class="company-info">
                            <p><strong>Name:</strong> ${company.name || 'N/A'}</p>
                            <p><strong>Active Jobs:</strong> ${activeJobsCount}</p>
                            <p><strong>Website:</strong> <a href="${company.website || '#'}" target="_blank">${company.website || 'N/A'}</a></p>
                            <p><strong>Description:</strong> ${company.description || 'N/A'}</p>
                            <p><strong>Location:</strong> ${company.location || 'N/A'}</p>
                            <p><strong>Size:</strong> ${company.size || 'N/A'}</p>
                            <p><strong>Hired People:</strong> ${company.hired_people || 'N/A'}</p>
                            <p><strong>Created At:</strong> ${company.created_at || 'N/A'}</p>
                            <img src="${company.logo || 'assets/images/avata.jpeg'}" alt="Company Logo" style="max-width: 150px; margin-top: 10px;">
                        </div>
                    `;

                    // Update navbar elements
                    const companyNameEl = document.getElementById('companyName');
                    const companyNameFullEl = document.getElementById('companyFullName');
                    const companyWebsiteEl = document.getElementById('companyWebsite');
                    const companyLogoEl = document.getElementById('companyLogo');

                    if (companyNameEl) companyNameEl.textContent = company.name || 'N/A';
                    if (companyNameFullEl) companyNameFullEl.textContent = `Active Jobs: ${activeJobsCount}`;
                    if (companyWebsiteEl) {
                        companyWebsiteEl.textContent = company.website || 'N/A';
                        companyWebsiteEl.href = company.website || '#';
                    }
                    if (companyLogoEl) companyLogoEl.src = company.logo || 'assets/images/avata.jpeg';
                } catch (error) {
                    console.error('About tab update error:', error);
                    const companyInfoDiv = document.getElementById('companyInfo');
                    if (companyInfoDiv) {
                        companyInfoDiv.innerHTML = '<p class="no-company">Error loading company information.</p>';
                    }
                }
            }

            // Check company on Settings tab click
            try {
                const settingsTab = document.getElementById('settingsTab');
                if (settingsTab) {
                    settingsTab.addEventListener('click', async function (e) {
                        try {
                            const data = await fetchCompanyData();
                            if (data && data.company) {
                                Swal.fire({
                                    icon: 'info',
                                    title: 'Company Exists',
                                    text: 'You already have a company.',
                                });
                                const companyForm = document.getElementById('companyForm');
                                if (companyForm) {
                                    companyForm.querySelectorAll('input, button').forEach(el => el.disabled = true);
                                    console.log('Company form disabled');
                                }
                            } else {
                                const companyForm = document.getElementById('companyForm');
                                if (companyForm) {
                                    companyForm.querySelectorAll('input, button').forEach(el => el.disabled = false);
                                    console.log('Company form enabled');
                                }
                            }
                            switchToSettingsTab();
                        } catch (error) {
                            console.error('Settings tab check error:', error);
                        }
                    });
                } else {
                    console.error('Settings tab link not found');
                }
            } catch (error) {
                console.error('Settings tab setup error:', error);
            }

            // Form submission
            // try {
            //     const companyForm = document.getElementById('companyForm');
            //     if (companyForm) {
            //         companyForm.addEventListener('submit', async function (e) {
            //             e.preventDefault();
            //             const formData = new FormData(this);
            //             try {
            //                 const super_token = sessionStorage.getItem("super_token") || "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczovL2pvYml6YWEuY29tL2FwaS9hZG1pbi9sb2dpbiIsImlhdCI6MTc0NzE3MzI1MSwibmJmIjoxNzQ3MTczMjUxLCJqdGkiOiJNNXNHU0lBNDZMa1AwM0wwIiwic3ViIjoiMSIsInBydiI6ImRmODgzZGI5N2JkMDVlZjhmZjg1MDgyZDY4NmM0NWU4MzJlNTkzYTkiLCJyb2xlcyI6WyJzdXBlci1hZG1pbiJdLCJwZXJtaXNzaW9ucyI6WyJtYW5hZ2UtYWxsLWNvbXBhbmllcyIsIm1hbmFnZS1hbGwtam9icyIsIm1hbmFnZS1yb2xlcyIsIm1hbmFnZS1jb21wYW55LWFkbWlucyIsIm1hbmFnZS1hcHBsaWNhdGlvbnMiLCJ2aWV3LWFwcGxpY2FudC1wcm9maWxlcyIsInNlbmQtbWVzc2FnZXMiXSwiY29tcGFueV9pZCI6bnVsbH0.X2ezIVql0YUgkruYV058QG8NpyHzAZSdHv60zAA_9R0";
            //                 const response = await fetch('/api/company', {
            //                     method: 'POST',
            //                     headers: {
            //                         Authorization: super_token,
            //                         Accept: 'application/json'
            //                     },
            //                     body: formData
            //                 });
            //                 if (response.ok) {
            //                     Swal.fire({
            //                         icon: 'success',
            //                         title: 'Success',
            //                         text: 'Company details saved!',
            //                     });
            //                     console.log('Form submitted successfully');
            //                     // Refresh About tab
            //                     updateAboutTab();
            //                 } else {
            //                     Swal.fire({
            //                         icon: 'error',
            //                         title: 'Error',
            //                         text: 'Failed to save company details.',
            //                     });
            //                     console.error('Form submission failed:', response.status);
            //                 }
            //             } catch (error) {
            //                 Swal.fire({
            //                     icon: 'error',
            //                     title: 'Error',
            //                     text: 'An error occurred while submitting the form.',
            //                 });
            //                 console.error('Form submission error:', error);
            //             }
            //         });
            //     } else {
            //         console.error('Company form not found');
            //     }
            // } catch (error) {
            //     console.error('Form setup error:', error);
            // }

            // Initialize Leaflet map
            try {
                const mapDiv = document.getElementById('map');
                if (!mapDiv) {
                    console.error('Map container not found');
                    Swal.fire({
                        icon: 'error',
                        title: 'Map Error',
                        text: 'Map container not found. Please check the page structure.',
                    });
                    return;
                }
                console.log('Initializing map');
                const map = L.map('map').setView([51.505, -0.09], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors'
                }).addTo(map);
                console.log('Map initialized successfully');

                let marker = null;

                // Update location input on map click
                map.on('click', function (e) {
                    try {
                        const { lat, lng } = e.latlng;
                        console.log('Map clicked at:', lat, lng);
                        if (marker) {
                            map.removeLayer(marker);
                        }
                        marker = L.marker([lat, lng]).addTo(map);
                        const locationInput = document.getElementById('location');
                        if (!locationInput) {
                            console.error('Location input not found');
                            return;
                        }
                        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`, {
                            headers: {
                                'User-Agent': 'HyperDashboard/1.0'
                            }
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data && data.display_name) {
                                    locationInput.value = data.display_name;
                                    console.log('Location set to:', data.display_name);
                                } else {
                                    locationInput.value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                                    console.log('Location set to coordinates:', locationInput.value);
                                }
                            })
                            .catch(error => {
                                locationInput.value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                                console.error('Geocoding error:', error);
                                Swal.fire({
                                    icon: 'warning',
                                    title: 'Geocoding Failed',
                                    text: 'Unable to fetch address. Using coordinates instead.',
                                });
                            });
                    } catch (error) {
                        console.error('Map click error:', error);
                    }
                });

                // Update map when typing in location input
                const locationInput = document.getElementById('location');
                if (locationInput) {
                    locationInput.addEventListener('change', function () {
                        const location = this.value;
                        if (location) {
                            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}`, {
                                headers: {
                                    'User-Agent': 'HyperDashboard/1.0'
                                }
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.length > 0) {
                                        const { lat, lon } = data[0];
                                        map.setView([lat, lon], 13);
                                        if (marker) {
                                            map.removeLayer(marker);
                                        }
                                        marker = L.marker([lat, lon]).addTo(map);
                                        console.log('Map updated to:', lat, lon);
                                    } else {
                                        console.log('No geocoding results for:', location);
                                        Swal.fire({
                                            icon: 'warning',
                                            title: 'Invalid Location',
                                            text: 'Could not find the specified location.',
                                        });
                                    }
                                })
                                .catch(error => {
                                    console.error('Geocoding error:', error);
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Geocoding Error',
                                        text: 'Unable to process location.',
                                    });
                                });
                        }
                    });
                } else {
                    console.error('Location input not found');
                }
            } catch (error) {
                console.error('Map initialization error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Map Error',
                    text: 'Failed to initialize map. Please check your network or script loading.',
                });
            }

            // Switch to Settings tab
            function switchToSettingsTab() {
                try {
                    const settingsTab = document.querySelector('a[href="#settings"]');
                    if (settingsTab) {
                        const tabInstance = new bootstrap.Tab(settingsTab);
                        tabInstance.show();
                        console.log('Switched to Settings tab');
                    } else {
                        console.error('Settings tab not found');
                    }
                } catch (error) {
                    console.error('Tab switch error:', error);
                }
            }

            // Initialize About tab
            updateAboutTab();
        });
    </script>
</body>
</html>